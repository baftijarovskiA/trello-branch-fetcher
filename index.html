<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Branch</title>
  </head>
  <body>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
      let ICON =
        "https://cdn.glitch.me/us-east-1%3A3d31b21c-01a0-4da2-8827-4bc6e88b7618%2Ficon-gray.svg";

      let onItemClick = function (branchName) {
        window.navigator.clipboard.writeText(branchName);
        alert("Branch copied!");
      };

      let buttonCallback = function (t, opts) {
        return t
          .board("name")
          .get("name")
          .then((name) => {
            console.log("Board name: ", name);
            const BOARD_PREFIX = name.split("[").pop().replace("]", "");

            return t
              .card("url")
              .get("url")
              .then((url) => {
                const CARD_URL = url.split("/").pop();
                const BRANCH_NAME = BOARD_PREFIX + "-" + CARD_URL;

                return t.popup({
                  title: "Branch Name",
                  items: [
                    {
                      text: BRANCH_NAME,
                      callback: onItemClick(BRANCH_NAME),
                    },
                  ],
                });
              });
          });
      };

      window.TrelloPowerUp.initialize({
        "card-buttons": function (t, opts) {
          return [
            {
              icon: ICON,
              text: "Branch 6",
              callback: buttonCallback,
            },
          ];
        },
      });
    </script>
  </body>
</html>
